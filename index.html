<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Wheel Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #ff4757;
            --dark: #2f3542;
        }
        body { 
            text-align: center; font-family: 'Sarabun', sans-serif; 
            background: #f1f2f6; margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh;
        }
        #resultText { font-size: 28px; font-weight: bold; color: var(--primary); margin-bottom: 20px; height: 40px; }
        
        .wheel-container { 
            position: relative; width: 90vw; max-width: 450px; 
            aspect-ratio: 1/1; margin: 0 auto;
        }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid white; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white; }
        
        .arrow { 
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent;
            border-top: 40px solid var(--dark); z-index: 10;
        }

        .controls { margin-top: 30px; width: 100%; }
        button { 
            width: 80%; max-width: 300px; padding: 15px; font-size: 22px; font-weight: bold;
            cursor: pointer; background: var(--primary); color: white; border: none; 
            border-radius: 50px; transition: 0.3s; box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
        }
        button:hover { transform: scale(1.05); }
        button:active { transform: scale(0.95); }
        button:disabled { background: #ccc; box-shadow: none; }
    </style>
</head>
<body>

    <div id="resultText">กดปุ่มเพื่อเริ่มสุ่ม!</div>

    <div class="wheel-container">
        <div class="arrow"></div>
        <canvas id="wheel" width="500" height="500"></canvas>
    </div>

    <div class="controls">
        <button id="spinBtn">หมุนเลย!</button>
    </div>

<script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const resultText = document.getElementById("resultText");

    const options = ["100บาท", "เกลือ", "20บาท", "10บาท", "นํ้าส้มสายชู", "1บาท"];
    const colors = ["#ff9f43", "#ee5253", "#0abde3", "#10ac84", "#5f27cd", "#f368e0"];
    const _pData = [0.001, 43.499, 1, 2, 43.5, 10]; // เปอร์เซ็นต์ (%)

    let currentAngle = 0;
    let isSpinning = false;
    let lastSoundIndex = -1;

    // สร้างเสียงประกอบแบบสังเคราะห์ (ไม่ต้องโหลดไฟล์ .mp3)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTick() {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(800, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    function draw() {
        const arc = (Math.PI * 2) / options.length;
        ctx.clearRect(0, 0, 500, 500);
        options.forEach((text, i) => {
            const angle = currentAngle + i * arc;
            ctx.fillStyle = colors[i];
            ctx.beginPath();
            ctx.moveTo(250, 250);
            ctx.arc(250, 250, 250, angle, angle + arc);
            ctx.fill();
            ctx.save();
            ctx.fillStyle = "white"; ctx.font = "bold 20px Sarabun";
            ctx.translate(250 + Math.cos(angle + arc/2) * 170, 250 + Math.sin(angle + arc/2) * 170);
            ctx.rotate(angle + arc/2 + Math.PI/2);
            ctx.fillText(text, -ctx.measureText(text).width/2, 0);
            ctx.restore();
        });
    }

    function getWinner() {
        let r = Math.random() * 100;
        let sum = 0;
        for (let i = 0; i < _pData.length; i++) {
            sum += _pData[i];
            if (r <= sum) return i;
        }
        return 0;
    }

    spinBtn.onclick = () => {
        if (isSpinning) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        isSpinning = true;
        spinBtn.disabled = true;
        resultText.innerText = "กำลังลุ้น...";

        const winnerIndex = getWinner();
        const rotationRounds = 8 + Math.floor(Math.random() * 5);
        const sectorDeg = 360 / options.length;
        const targetDeg = (rotationRounds * 360) + (270 - (winnerIndex * sectorDeg) - (sectorDeg / 2));
        
        const startDeg = currentAngle * 180 / Math.PI;
        const totalDist = targetDeg - (startDeg % 360);
        const duration = 5000;
        const startTime = performance.now();

        function animate(now) {
            const elapsed = now - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const ease = 1 - Math.pow(1 - progress, 4);
            const currentDeg = startDeg + (totalDist * ease);
            currentAngle = currentDeg * Math.PI / 180;
            
            // เล่นเสียง Tick เมื่อเลื่อนผ่านช่อง
            const currentSector = Math.floor((360 - (currentDeg % 360)) / sectorDeg) % options.length;
            if (currentSector !== lastSoundIndex) {
                playTick();
                lastSoundIndex = currentSector;
            }

            draw();
            if (progress < 1) requestAnimationFrame(animate);
            else {
                isSpinning = false;
                spinBtn.disabled = false;
                resultText.innerText = "ยินดีด้วย! " + options[winnerIndex];
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        }
        requestAnimationFrame(animate);
    };

    draw();
</script>
</body>
</html>





