<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Golden Risk - Mobile Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&family=Goldman:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --gold: #FFD700;
            --dark-gold: #B8860B;
            --bg: #050505;
        }
        body { 
            text-align: center; font-family: 'Sarabun', sans-serif; 
            background: var(--bg); color: white; margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            /* ใช้ dvh เพื่อให้เต็มจอจริงบนมือถือ (ไม่รวม address bar) */
            min-height: 100dvh; 
            overflow: hidden;
            touch-action: manipulation; /* ป้องกันการ delay เวลากดปุ่มบนมือถือ */
        }
        
        h1 { 
            font-family: 'Goldman', cursive; 
            font-size: clamp(36px, 12vw, 60px); /* ปรับขนาดอักษรตามจอ */
            color: var(--gold); margin: 0 0 5px 0;
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.6);
            letter-spacing: 2px;
            line-height: 1.1;
        }
        
        #resultText { 
            font-size: clamp(18px, 5vw, 24px); 
            font-weight: bold; color: #ccc; 
            margin-bottom: 15px; height: 30px; 
            text-shadow: 1px 1px 5px rgba(0,0,0,0.8);
        }
        
        /* ปรับวงล้อให้ใหญ่เกือบเต็มจอมือถือ */
        .wheel-outer {
            position: relative; padding: 10px; border-radius: 50%;
            background: linear-gradient(145deg, #FFD700, #5c4505, #B8860B);
            box-shadow: 0 0 40px rgba(184, 134, 11, 0.4);
            border: 2px solid rgba(255, 215, 0, 0.2);
        }
        .wheel-container { 
            position: relative; 
            width: 92vw; /* กว้าง 92% ของจอมือถือ */
            max-width: 500px; 
            aspect-ratio: 1/1;
        }
        #wheel { width: 100%; height: 100%; border-radius: 50%; background: #000; }
        
        .arrow { 
            position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent;
            border-top: 45px solid #fff; z-index: 30;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.9));
        }

        .controls { 
            margin-top: 30px; 
            width: 100%; 
            display: flex; 
            justify-content: center;
        }
        
        /* ปุ่มขนาดใหญ่กดง่ายสำหรับนิ้วโป้ง */
        button { 
            width: 80%; max-width: 350px; 
            padding: 20px 0; 
            font-size: 24px; font-family: 'Goldman';
            cursor: pointer; background: linear-gradient(to bottom, #FFD700, #B8860B); 
            color: #000; border: none; border-radius: 50px; font-weight: bold;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 2px 0 rgba(255,255,255,0.5);
            text-transform: uppercase; letter-spacing: 1px;
            -webkit-tap-highlight-color: transparent; /* ลบสีเทาเวลากดบนมือถือ */
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.96); box-shadow: 0 5px 10px rgba(0,0,0,0.5); }
        button:disabled { background: #333; color: #555; box-shadow: none; filter: grayscale(1); }

        .shake-screen { animation: heavyShake 0.8s ease-out; }
        @keyframes heavyShake {
            0%, 100% { transform: translate(0,0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-6px, 2px); }
            20%, 40%, 60%, 80% { transform: translate(6px, -2px); }
        }
    </style>
</head>
<body id="mainBody">

    <h1>GOLDEN RISK</h1>
    <div id="resultText">แตะปุ่มเพื่อเสี่ยงดวง</div>

    <div class="wheel-outer">
        <div class="wheel-container">
            <div class="arrow"></div>
            <canvas id="wheel" width="800" height="800"></canvas>
        </div>
    </div>

    <div class="controls">
        <button id="spinBtn">SPIN NOW</button>
    </div>

<script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const resultText = document.getElementById("resultText");
    const mainBody = document.getElementById("mainBody");

    const options = ["ผงชูรส", "เกลือ", "20บาท", "10บาท", "นํ้ามะนาว", "1บาท", "100บาท"];
    const colors = ["#000000", "#d4af37", "#000000", "#d4af37", "#000000", "#d4af37", "#cc0000"];
    
    // โอกาสรางวัลใหญ่ 0.001%
    const _pData = [25, 25, 1, 2, 26.999, 20, 0.001]; 

    let currentAngle = 0;
    let isSpinning = false;
    let lastSoundIndex = -1;

    // แก้ไข AudioContext ให้ทำงานบน iOS Safari ได้ดีขึ้น
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playTick() {
        // สร้างเสียงสั้นๆ และทุ้มกว่าเดิมเล็กน้อยให้ดูมีน้ำหนัก
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(400, audioCtx.currentTime); // เสียงทุ้มลง
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
        osc.start(); osc.stop(audioCtx.currentTime + 0.05);
    }

    function draw() {
        const size = 800; // ขนาด Canvas
        const center = size / 2;
        const radius = size / 2 - 10;
        const arc = (Math.PI * 2) / options.length;
        
        ctx.clearRect(0, 0, size, size);
        
        options.forEach((text, i) => {
            const angle = currentAngle + i * arc;
            
            ctx.fillStyle = colors[i];
            ctx.beginPath();
            ctx.moveTo(center, center);
            ctx.arc(center, center, radius, angle, angle + arc);
            ctx.fill();
            
            ctx.strokeStyle = "#FFD700";
            ctx.lineWidth = 5; // เส้นหนาขึ้น
            ctx.stroke();

            ctx.save();
            ctx.fillStyle = (colors[i] === "#000000" || colors[i] === "#cc0000") ? "#FFD700" : "#000000";
            // ปรับขนาดฟอนต์ให้ใหญ่ขึ้นเพื่อให้อ่านง่ายบนมือถือ
            ctx.font = "bold 40px Sarabun"; 
            ctx.translate(center + Math.cos(angle + arc/2) * (radius * 0.65), center + Math.sin(angle + arc/2) * (radius * 0.65));
            ctx.rotate(angle + arc/2 + Math.PI / 2);
            ctx.fillText(text, -ctx.measureText(text).width/2, 0);
            ctx.restore();
        });

        // จุดกลาง
        ctx.fillStyle = "#FFD700";
        ctx.beginPath();
        ctx.arc(center, center, 25, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 4;
        ctx.stroke();
    }

    function getWinner() {
        let r = Math.random() * 100;
        let sum = 0;
        for (let i = 0; i < _pData.length; i++) {
            sum += _pData[i];
            if (r <= sum) return i;
        }
        return 1;
    }

    spinBtn.onclick = () => {
        if (isSpinning) return;
        
        // ปลุก AudioContext (จำเป็นมากสำหรับ iOS/Android)
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        isSpinning = true;
        spinBtn.disabled = true;
        resultText.innerText = "กำลังหมุนด้วยความเสี่ยง...";
        mainBody.classList.remove("shake-screen");

        const winnerIndex = getWinner();
        // ลดรอบหมุนลงเล็กน้อย เพื่อให้รู้สึกว่าวงล้อมันหนัก เริ่มต้นช้าๆ ไม่พุ่งปรู้ด
        const rotationRounds = 10; 
        const sectorDeg = 360 / options.length;
        const randomPosInSector = (Math.random() * 0.7 + 0.15) * sectorDeg;
        const targetDeg = (rotationRounds * 360) + (270 - (winnerIndex * sectorDeg) - randomPosInSector);
        
        const startDeg = currentAngle * 180 / Math.PI;
        const totalDist = targetDeg - (startDeg % 360);
        
        // --- ความหนืดระดับ "ยางมะตอย" ---
        const duration = 12000; // 12 วินาที (นานขึ้น)
        const startTime = performance.now();

        function animate(now) {
            const elapsed = now - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // ใช้สูตร Power 6 (Hexic) = หนืดกว่าเดิมมาก
            // วงล้อจะใช้เวลาในการ "คลาน" เข้าเส้นชัยนานขึ้น
            const ease = 1 - Math.pow(1 - progress, 6);
            
            const currentDeg = startDeg + (totalDist * ease);
            currentAngle = currentDeg * Math.PI / 180;
            
            const currentSector = Math.floor((270 - (currentDeg % 360) + 360) % 360 / sectorDeg);
            if (currentSector !== lastSoundIndex) {
                playTick();
                lastSoundIndex = currentSector;
            }

            draw();
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                isSpinning = false;
                spinBtn.disabled = false;
                resultText.innerText = "ผลลัพธ์: " + options[winnerIndex];
                mainBody.classList.add("shake-screen");
                confetti({ 
                    particleCount: 200, spread: 90, origin: { y: 0.7 },
                    colors: ['#FFD700', '#FFFFFF', '#B8860B'],
                    disableForReducedMotion: true
                });
            }
        }
        requestAnimationFrame(animate);
    };

    // วาดครั้งแรก
    draw();
    
    // ปรับขนาด Canvas อัตโนมัติถ้าย่อขยายจอ
    window.addEventListener('resize', draw);
</script>
</body>
</html>





